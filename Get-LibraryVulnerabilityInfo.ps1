<#
.SYNOPSIS
Get the list of module/package/library vulnerabilities from the RetireJS or SafeNuGet projects.

.PARAMETER Name
The name of the module or package or library to check.

.PARAMETER Repository
Whether to check the NPM, JS, or NuGet vulnerability lists.

.INPUTS
System.String of a package/module name to search for.

.OUTPUTS
System.Management.Automation.PSCustomObject with details about any vulnerabilities found.

.LINK
Invoke-RestMethod

.LINK
Select-Xml

.EXAMPLE
Get-JsVulnerabilityInfo.ps1 Backbone.js

atOrAbove below identifiers
--------- ----- -----------
0.5.0 @{release=0.5.0; summary=cross-site scripting vulnerability}

.EXAMPLE
Get-JsVulnerabilityInfo.ps1 Backbone.js -Repository nuget

| afterOrAt before infoUri
| --------- ------ -------
|           0.5.3  http://backbonejs.org/#changelog
#>

#Requires -Version 3
[CmdletBinding()][OutputType([Management.Automation.PSCustomObject])] Param(
[Parameter(Position=0,Mandatory=$true,ValueFromPipeline=$true)]
[Alias('Module','Package','Library')][string]$Name,
[ValidateSet('js','npm','nuget')][string]$Repository = 'js'
)
Process
{
    if($Repository -eq 'nuget')
    {
        Invoke-RestMethod https://raw.githubusercontent.com/OWASP/SafeNuGet/master/feed/unsafepackages.xml |
            Select-Xml //package |
            foreach Node |
            where {$_.id -eq $Name} |
            foreach {[pscustomobject]@{afterOrAt=$_.afterOrAt;before=$_.before;infoUri=$_.infoUri}}
    }
    else
    {
        $lib = Invoke-RestMethod https://raw.githubusercontent.com/RetireJS/retire.js/master/repository/${Repository}repository.json
        if($lib.$Name) {$lib.$Name.vulnerabilities |select atOrAbove,below,identifiers,info}
        else {Write-Warning "$Name not found"}
    }
}
